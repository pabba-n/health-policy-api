<!doctype html>
<html>
<head>
	<title>Health Information Disclosure Policy API</title>
	<meta charset="utf-8"/>
	<script    src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
	<script>
		
				
				

			
		function getPolicy() {
			/* Step 1: Make instance of request object...
			...to make HTTP request after page is loaded*/
			request = new XMLHttpRequest();
			console.log("1 - request object created");
 
			// Step 2: Set the URL for the AJAX request to be the JSON file
 
		// request.open("GET", "https://www.healthit.gov/data/open-api?source=SKA_State_County_Data_2011-2013.csv", true)
			request.open("GET", "https://www.healthit.gov/data/open-api?source=state-health-it-privacy-consent-law-policies.csv", true)
			
			console.log("2 - opened request file");
 
			// Step 3: set up event handler/callback

			request.onreadystatechange = function() {
				console.log("3 - readystatechange event fired.");
 
				if (request.readyState == 4 && request.status == 200) {

					// Step 5: wait for done + success
					console.log("5 - response received");
					result = request.responseText;
					data = JSON.parse(result);
					string = JSON.stringify(data)
					string += "<br><br><br>1. The API I selected describes health information disclosure policies across all 50 states since these policies can vary across state lines. What the API does is give you information about the disclosure policies in each state and whether patients must opt-in in order for their health information to be sent from place to place. ";
					string += "<br><br><br>2. The website I used was <a href=\"https://www.healthit.gov/data/datasets/state-health-it-privacy-and-consent-laws-and-policies\">this.</a>"
					string += "<br><br><br>3. describe the options you used for the API request...";
					string += "<br><br><br>4. This API can be used to make it easier to find what states have opt-in disclosure policies. This can be done in 2 ways. One, having a select bar to select a state and then displaying information about that state's policies. And two, creating an interactive map for a user to toggle over a state and see the state's health disclosure policies.";
					// console.log(data[0]["state"]);
					// var t= "Select a state: ";
					// t += "<select id='state'>";
					// for(i=0; i<50; i++) {
					// 	t += "<option>" + data[i]["state"] + "</option>";
					// }
					// t+= "</select>"; 
					document.getElementById("data").innerHTML = string;	 
					
				} else if (request.readyState == 4 && request.status != 200) {

					document.getElementById("data").innerHTML = "Something is wrong!  Check the logs to see where this went off the rails";

				}

				else if (request.readyState == 3) {

					document.getElementById("data").innerHTML = "Too soon!  Try again";

				}

			}
			
		// Step 4: fire off the HTTP request
			request.send();
			console.log("4 - Request sent");
		}
		$('select').on('change', (event) => {
						console.log(event)
						console.log("val: " + document.getElementById("#state").val());
		});
		
	</script>
</head>


<body onload="getPolicy()">

	<h1>Health Information Disclosure Policies</h1>
	<div id="data">Loading...</div>
</body>
</html>